sudo: required
language: node_js
services:
- docker
env:
  global:
  - DOCKER_COMPOSE_VERSION=1.23.1
  - COMMIT=${TRAVIS_COMMIT::8}
  - API=trifold-api
  - API_REPO=https://github.com/jdecked/$API.git
  - CLIENT=trifold-client
  - CLIENT_REPO=https://github.com/jdecked/$CLIENT.git
  - NGINX=trifold
  - NGINX_REPO=https://github.com/jdecked/$NGINX.git#master:nginx
  - DJANGO=2.1
  - DJANGO_ENVIRONMENT=testing
  - secure: iWUDAAg8zflgp3BTCxiQYF8xF7RLtQN2DcHZqm7PhnVwnzNKIoqP5UAXDwtDaIrIrjWroay9GLOUorBxhnmaoWbM64JtUUyWXUCabBZFF38Y8bar3rtMAyPJ1bZyOw4NAGM2V96pK5L9aRKpaBJk0dv10shizLuqzOT7LdAaXa6PhKH7Q6zczzdc8tyRXChjk1qFXYj2/ZrNxCpZ7Y0QhllUrLvHZ4i4VOGqBuxKKJahwsg9qccxu+y1KEyi/27UX4gsDa+A7kL9uVHZIHxH7T0DosZe0pobNVYcUsI4g0O+Ky00JufGyo/gXVjEQTGdn//do7qljY+hQcmjFtYdDGvTj9HQ2A9k8nYilRWVDPv88Jp6G9W4loFQNgb4zMBC9WKcrixC+mzwdq3CzX5CpQ2ZyC8vTE7vjUuXUyJvhSi79kiRYiRAf1aaSnQQj9kXtpMWT2IcIkKbjn8UIZ1qAni7/NBOf+onATb5/JIKoU5XvIXrenR/F1FgPSIarCM8HQd1lFjUbjYkp1+nnfDv2z5yW1+UquIDWagzSRpokupOHsozGgzMNvsh2/WUaCtJmkNs56Ylzl55ijPWfkKx18IQOv0GVo2DOwnZfzvKquycGcdcw04mConF99/EUrNXPcQqylkcKAD1E8FeBJmqyQpvaGCsiKUJ7dvdfHWGpBo=
before_install:
- sudo apt-get update
- sudo apt-get install -o Dpkg::Options::="--force-confold" --force-yes -y docker-ce
- docker-compose --version
- sudo rm /usr/local/bin/docker-compose
- curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname
  -s`-`uname -m` > docker-compose
- chmod +x docker-compose
- sudo mv docker-compose /usr/local/bin
script:
- docker-compose -f docker-compose-ci.yml build api-service
- docker-compose -f docker-compose-ci.yml build web-service
- docker-compose -f docker-compose-ci.yml up -d
- docker-compose -f docker-compose-ci.yml run api-service python manage.py test
- docker-compose -f docker-compose-ci.yml run web-service yarn test
after_script:
- docker-compose down
after_success:
- bash ./docker_push.sh
deploy:
  provider: heroku
  api_key:
    secure: Mtzio9P8VOZ4W/3Anh9TDzFESdy+iQGhYgM06Xqay78i/Y2/Vf+D94OworVLCfmqCbWR+YrgviewDuehxH7h88i98XSoxBSVHg1wzZ7kCGnzP0IUjDyfhb72iBaEdfFIJIlCeLbawmC8t5myyS9tI1FBh76u3kRSLxgDAg1PYcARosEyH7hp5ZlHOLqRcgufw7RJVEbjToVL4PM5oIefAYx58tQ9C8ITENBG4Cd+3mSGDblnOnUGOILmrJMN9RAXOFniMFzRiT0d10RXM9DMyt6w5Eo9eBwg119m3Sh6io3lRG3PKbDvWAGiUQPc4NduOASfZwe1fQyIK5RzLPcAU5DgiCvO5BQ1CYLyrFMUSyKt8nGjXpjJleNVw0nbA0O26mqAdzyboYD6Br1UgVHKgo8aiiCDnXrnzWPNa+1WkVGCuStUNQU3EOgiymaWDTCRGZ+CzgVZtnwkiFaz2LL0UYQ1hfydEa3GpbDg+fqDyjSTOG2BhpAD+Bizc2iZkLaahF8iIGDYMBZTTBJMD7d6nlmciTbxtPagcJKCcVwfgJ/7e/1V6voMbFiOLV9MrFH8+wjw2i0Q30Z+EaFRH7mHClgPMsAlFQbAb3uSTUgD4jAT4IkotecbMrnSGwj5azupWwBMU4WD6rqQAMTOJ1oZY+IDmJ0B9/HWy8O/w4EkON8=
